# NIST Digital Servo

Ion Storage Group  
Time and Frequency Division  
National Institute of Standards and Technology  
Boulder, CO USA

Authors:  
David Leibrandt (david.leibrandt@nist.gov)  
Jason Heidecker

The NIST digital servo is designed to be a general purpose feedback controller, implemented digitally using an FPGA.  The advantages of an all-digital approach include fast and easy (no soldering) reconfiguration of the feedback transfer function, loop shapes that go beyond PID, the ability to perform automatic lock acquisition, and the integration of diagnostics for easy analysis of open and closed loop system performance.  The NIST digital servo has been optimized for feedback control of lasers in atomic, molecular, and optical (AMO) physics experiments, but it should be applicable in other control applications with similar bandwidth, noise, and loop shape requirements.

This github repository contains the hardware, firmware, and software design files, as well as precompiled firmware and software binaries to run the digital servo on Windows 7.

For more information about the firmware and performance of the digital servo, as well as example use cases, please refer to D. R. Leibrandt and J. Heidecker, [arXiv:1508.06319](http://arxiv.org/abs/1508.06319) (2015).

For instructions on setting up the digital servo using the precompiled binaries on Windows 7 (which does not require installing or using any compilers) and on operation of the GUI, please see `doc\NIST_digital_servo_manual.pdf`.

The hardware design and fabrication files are located in the `hardware` folder.  The firmware source code files are located in the `firmware` folder.  The GUI source code files are located in the `gui` folder.  And matlab functions for reading in data files generated by the digital servo are located in the `matlab` folder.

## Building forward compatibility to newer FPGAs

Author: Michael Lee

Existing code has been updated for compatibility for the newer Spartan-6 FPGA with the same footprint, XEM6310. For forward compatibility to XEM7010, it would require some hardware changes as well, which is work to be done in the future.

### Migration to XEM6310-LX150

According to https://docs.opalkelly.com/display/XEM6310/Migrating+Hardware+from+the+XEM6010+to+XEM6310, the main changes from XEM6010 to XEM6310 are:

1. Replacement of Cypress CY22393 multi-output PLL to a fixed-output 100MHz clock. As a result, the constraints file has been modified to accomodate this change. A clock signal is generated in the top level file (SuperLaserLand.v).
2. A change in some expansion connectors which fortunately were not used in the Liebrandt's design.
3. Upgrade of USB 2.0 to USB 3.0 Host interface. Opal Kelly host interface is now 41 signals instead of 26. The Opal Kelly interface on the top level file has been modified. Not sure yet whether the corresponding C++ code has to be changed.
4. JP3 is now labelled as JP1. The relevant Ferrite bead to remove is FB1, not FB2, to externally supply power to pins JP1-36,56 (formerly JP3-36,56). (The I/O Bank 0 includes the same pins as before - allowing these pins to be driven with a 2.5V I/O standard).

### Migration to XEM7010 (difficult)

According to https://docs.opalkelly.com/display/XEM7010/Migrating+Hardware+from+the+XEM6010, the main changes from XEM6010 to XEM7010 are:

1. Upgrade from 128MiB DDR2 SDRAM to 512MiB DDR3 SDRAM. This requires a change in the DDR access drivers.
2. Replacement of Cypress CY22393 multi-output PLL to a fixed-output 200MHz clock.
3. Change in expansion connectors (fortunately, the changed connectors were not used in the Liebrandt's design)
4. JP3 is now labelled as MC1. The relevant Ferrite bead to remove is FB4, not FB2, to externally supply power to pins MC1-36,56 (formerly JP3-36,56).
5. XEM7010 forces the pins between and including MC1-63 to MC1-76 to be powered with a 3.3V I/O standard (see https://docs.opalkelly.com/display/XEM7010/Expansion+Connectors). Originally, these pins were JP3-63 to JP3-76, which were part of an FPGA bank externally powered to have a 2.5V. Most of these pins were used to control the LVDS interface on the fast DAC. However, the LVDS_33 standard (LVDS with 3.3V supply) is no longer supported in the 7 series FPGAs as a differential output (https://www.xilinx.com/support/answers/43989.html);  these pins (since they are 3.3V powered) can only ever be used as an input pins for LVDS signals. Hence it seems that XEM7010 cannot be made compatible, unless the hardware changes to reroute to other differential pins.
